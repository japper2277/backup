<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Calendar with Search and Expandable View</title>

    <!-- External Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/modals.css">
    
    <!-- Papa Parse for CSV loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    
    <!-- =================================== -->
    <!-- APP HEADER                         -->
    <!-- =================================== -->
    <div class="app-header">
        <div class="header-left">
            <div class="app-logo">
                <i class="fas fa-calendar-alt"></i>
                Mic Calendar
            </div>
            <div class="nav-toggle">
                <button class="nav-toggle-btn" id="mapNavBtn">
                    <i class="fas fa-map"></i>
                    Map
                </button>
                <button class="nav-toggle-btn active" id="calendarNavBtn">
                    <i class="fas fa-calendar"></i>
                    Calendar
                </button>
            </div>
        </div>
    </div>

    <!-- =================================== -->
    <!-- MAIN CALENDAR CONTAINER            -->
    <!-- =================================== -->
    <div class="set-history-calendar" id="calendarContainer">
        <h3 class="calendar-title">Set History</h3>
        
        <!-- Calendar View Toggle -->
        <div class="view-toggle">
            <button class="view-toggle-btn active" id="weekViewBtn">
                <i class="fas fa-calendar-week"></i>
                <span>Week</span>
            </button>
            <button class="view-toggle-btn" id="monthViewBtn">
                <i class="fas fa-calendar-alt"></i>
                <span>Month</span>
            </button>
            <button class="view-toggle-btn" id="listViewBtn">
                <i class="fas fa-list"></i>
                <span>List</span>
            </button>
        </div>
        
        <!-- Calendar Navigation -->
        <div class="calendar-nav">
            <span class="date-range" id="dateRange"></span>
            <div class="nav-controls">
                <button class="nav-btn" id="expandBtn" aria-label="Expand or collapse calendar">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="nav-btn" id="prevWeekBtn" aria-label="Previous week"><i class="fas fa-chevron-left"></i></button>
                <button class="nav-btn" id="nextWeekBtn" aria-label="Next week"><i class="fas fa-chevron-right"></i></button>
                <button class="today-btn" id="todayBtn">Today</button>
                <button class="add-set-btn" id="addSetBtn">
                    <i class="fas fa-plus fa-xs"></i> Add Set
                </button>
                <button class="add-set-btn add-mic-btn" id="addMicBtn" aria-label="Add a new mic to calendar">
                    <i class="fas fa-microphone fa-xs"></i> Add Mic
                </button>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="filter-group">
                <i class="fas fa-search"></i>
                <input type="search" id="venueSearch" class="filter-input" placeholder="Search venue, notes, or setlist...">
            </div>
            <div class="filter-group" style="display: flex; gap: 0.5rem;">
                <select id="typeFilter" class="filter-input" style="padding-left: 1rem;">
                    <option value="all">All Types</option>
                    <option value="blue">Showcase</option>
                    <option value="green">Open Mic</option>
                    <option value="orange">Corporate / Private</option>
                    <option value="red">Late Night</option>
                </select>
                <button id="advancedSearchToggle" class="nav-btn" title="Advanced Search" style="flex-shrink: 0;">
                    <i class="fas fa-sliders-h"></i>
                </button>
            </div>
            
            <!-- Advanced Search Panel -->
            <div class="advanced-search" id="advancedSearch">
                <div class="search-row">
                    <div class="filter-group">
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">Date Range</label>
                        <input type="date" id="dateFrom" class="filter-input" style="padding-left: 1rem;">
                    </div>
                    <div class="filter-group">
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">To</label>
                        <input type="date" id="dateTo" class="filter-input" style="padding-left: 1rem;">
                    </div>
                    <div class="filter-group">
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;">Min Jokes</label>
                        <input type="number" id="minJokes" class="filter-input" min="0" placeholder="0" style="padding-left: 1rem;">
                    </div>
                </div>
                <div class="search-row">
                    <button id="clearFilters" class="nav-btn" style="width: auto; padding: 0 1rem;">
                        <i class="fas fa-times"></i> Clear All
                    </button>
                    <div style="margin-left: auto; font-size: 0.8rem; color: var(--text-secondary); display: flex; align-items: center; gap: 1rem;">
                        <span>Shortcuts: <kbd style="background: var(--bg-surface-2); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">Ctrl+F</kbd> Search, <kbd style="background: var(--bg-surface-2); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem;">Ctrl+T</kbd> Today</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-grid-container">
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar content will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- =================================== -->
    <!-- MODALS AND POPUPS                  -->
    <!-- =================================== -->

    <!-- Right-Click Context Menu -->
    <div id="event-context-menu" class="context-menu" style="display: none;">
        <ul class="context-menu-list">
            <li class="context-menu-item" data-action="edit"><i class="fa-solid fa-fw fa-pencil"></i><span>Edit Set</span></li>
            <li class="context-menu-item delete" data-action="delete"><i class="fa-solid fa-fw fa-trash-can"></i><span>Delete Set</span></li>
        </ul>
    </div>

    <!-- Mic Selection Modal -->
    <div id="mic-selection-modal" class="modal-container" role="dialog" aria-labelledby="mic-modal-title" aria-describedby="mic-modal-desc">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close-btn" aria-label="Close modal">&times;</button>
            <h3 id="mic-modal-title" class="form-title">Select a Mic to Add</h3>
            <p id="mic-modal-desc" class="sr-only">Search and filter through available open mic venues to add to your calendar</p>
            
            <!-- Quick Filter Chips -->
            <div class="quick-filters" style="margin-bottom: 1rem;">
                <button class="filter-chip" data-filter="today">
                    <i class="fas fa-star"></i> Today
                </button>
                <button class="filter-chip" data-filter="tomorrow">
                    <i class="fas fa-calendar-plus"></i> Tomorrow
                </button>
                <button class="filter-chip" data-filter="free">
                    <i class="fas fa-dollar-sign"></i> Free
                </button>
                <button class="filter-chip" data-filter="popular">
                    <i class="fas fa-fire"></i> Popular
                </button>
                <button class="filter-chip" data-filter="clear">
                    <i class="fas fa-times"></i> Clear
                </button>
            </div>
            
            <div class="filter-controls" style="margin-bottom: 1.5rem;">
                <div class="filter-group">
                    <i class="fas fa-search"></i>
                    <input type="search" id="micSearch" class="filter-input" placeholder="Search venues...">
                </div>
                <div class="filter-group">
                    <i class="fas fa-calendar-day"></i>
                    <select id="dayFilter" class="filter-input" style="padding-left: 2.25rem;">
                        <option value="all">All Days</option>
                        <option value="Sunday">Sunday</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                    </select>
                </div>
            </div>
            
            <div id="micsList" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px;">
                <!-- Mic options will be populated here -->
            </div>
            
            <div class="form-actions">
                <button type="button" class="form-btn btn-secondary modal-cancel-btn">Cancel</button>
                <a href="index.html" class="form-btn btn-secondary" style="text-decoration: none; display: inline-flex; align-items: center;">
                    <i class="fas fa-external-link-alt" style="margin-right: 0.5rem;"></i>
                    Open Mic Finder
                </a>
            </div>
        </div>
    </div>

    <!-- Add/Edit Set Modal -->
    <div id="add-edit-modal" class="modal-container form-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close">&times;</button>
            <h3 class="form-title" id="formTitle">Log a New Set</h3>
            <form id="setForm">
                 <div class="form-grid">
                    <input type="hidden" id="setId" name="setId">
                    <div class="form-group"><label for="event-title">Event Title</label><input type="text" id="event-title" name="event-title" required placeholder="e.g., Showcase"></div>
                    <div class="form-group"><label for="venue">Venue</label><input type="text" id="venue" name="venue" required placeholder="e.g., The Comedy Cellar"></div>
                    <div class="form-group"><label for="date">Date</label><input type="date" id="date" name="date" required></div>
                    <div class="form-group"><label for="event-type">Event Type</label><select id="event-type" name="eventType" required><option value="blue">Showcase</option><option value="green">Open Mic</option><option value="orange">Corporate / Private</option><option value="red">Late Night</option></select></div>
                    <div class="form-group full-width"><label for="setlist">Setlist (one joke per line)</label><textarea id="setlist" name="setlist" placeholder="Scarecrow Joke&#10;Coffee Rant"></textarea></div>
                    <div class="form-group full-width"><label for="notes">Performance Notes</label><textarea id="notes" name="notes" placeholder="Crowd was... New tag landed..."></textarea></div>
                    <div class="form-actions">
                         <button type="button" class="form-btn btn-secondary modal-cancel-btn">Cancel</button>
                         <button type="submit" class="form-btn btn-primary">Save Set</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-container confirm-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this set? This action cannot be undone.</p>
            <div class="confirm-actions">
                <button class="form-btn btn-secondary modal-cancel-btn">Cancel</button>
                <button id="confirmDeleteBtn" class="form-btn btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Event Summary Modal -->
    <div id="event-summary-modal" class="modal-container">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close">&times;</button>
            <div id="summaryContent">
                <!-- Summary content will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- =================================== -->
    <!-- BOTTOM NAVIGATION                  -->
    <!-- =================================== -->
    <div class="bottom-nav" id="bottomNav">
        <a href="index.html" class="bottom-nav-item">
            <i class="fas fa-map"></i>
            <span>Map</span>
        </a>
        <div class="bottom-nav-item active">
            <i class="fas fa-calendar-alt"></i>
            <span>Calendar</span>
        </div>
        <div class="bottom-nav-item" id="statsNavBtn">
            <i class="fas fa-chart-bar"></i>
            <span>Stats</span>
        </div>
        <div class="bottom-nav-item" id="settingsNavBtn">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <!-- =================================== -->
    <!-- JAVASCRIPT                         -->
    <!-- =================================== -->
    <script src="js/calendar.js"></script>

</body>
</html>